<div
  *ngIf="isLoading"
  class="flex flex-col justify-center items-center h-screen text-white text-center"
>
  <mat-progress-spinner
    color="primary"
    mode="indeterminate"
  ></mat-progress-spinner>
  <p class="pt-8">Loading media details...</p>
</div>

<div *ngIf="mediaItem" class="lg:container lg:mx-auto py-8 px-4">
  <button
    [routerLink]="['/gallery']"
    class="mb-8 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center"
  >
    &larr; Back to Gallery
  </button>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <!-- Left Column: The Image/Video -->
    <div class="md:col-span-2">
      <!-- This container will be used by lightGallery to render the inline carousel -->
      <div #lightGalleryCarousel class="inline-gallery-container"></div>
    </div>

    <!-- Right Column: The Metadata -->
    <div class="md:col-span-1 text-white">
      <h2 class="text-3xl font-bold mb-4">Details</h2>
      <div class="space-y-3">
        <div *ngIf="mediaItem.original_prompt">
          <strong class="font-semibold">Original Prompt:</strong>
          <p>{{ mediaItem.original_prompt }}</p>
        </div>

        <div>
          <div
            class="flex cursor-pointer items-center justify-between"
            (click)="isPromptVisible = !isPromptVisible"
          >
            <strong class="font-semibold">Prompt used for generation:</strong>
            <button
              type="button"
              class="text-gray-400 hover:text-white focus:outline-none"
              aria-label="Toggle prompt visibility"
            >
              <mat-icon>{{ isPromptVisible ? 'expand_less' : 'expand_more' }}</mat-icon>
            </button>
          </div>
          <pre
            *ngIf="isPromptVisible"
            class="mt-1 rounded-md bg-gray-800 p-2 text-sm whitespace-pre-wrap break-words"
            >{{ formattedPrompt }}</pre>
        </div>

        <div *ngIf="mediaItem.rewritten_prompt">
          <strong class="font-semibold">Rewritten Prompt:</strong>
          <p>{{ mediaItem.rewritten_prompt }}</p>
        </div>

        <div>
          <strong class="font-semibold">Model:</strong>
          <p>{{ mediaItem.model || 'N/A' }}</p>
        </div>

        <div>
          <strong class="font-semibold">Creator:</strong>
          <p>{{ mediaItem.user_email || 'N/A' }}</p>
        </div>

        <div>
          <strong class="font-semibold">Created at:</strong>
          <p>{{ mediaItem.created_at | date: 'medium' }}</p>
        </div>

        <div>
          <strong class="font-semibold">Mime Type:</strong>
          <p>{{ mediaItem.mime_type || 'N/A' }}</p>
        </div>

        <div *ngIf="mediaItem.generation_time">
          <strong class="font-semibold">Generation Time:</strong>
          <p>{{ mediaItem.generation_time }} seconds</p>
        </div>

        <div *ngIf="mediaItem.error_message">
          <strong class="font-semibold">Error Message:</strong>
          <p>{{ mediaItem.error_message }}</p>
        </div>

        <div *ngIf="mediaItem.gcsuri">
          <strong class="font-semibold">GCS URI:</strong>
          <p>{{ mediaItem.gcsuri }}</p>
        </div>

        <div *ngIf="mediaItem.gcs_uris">
          <strong class="font-semibold">GCS URIs:</strong>
          <ul>
            <li *ngFor="let uri of mediaItem.gcs_uris">{{ uri }}</li>
          </ul>
        </div>

        <div *ngIf="mediaItem.source_images_gcs?.length">
          <strong class="font-semibold">Source Images GCS:</strong>
          <ul>
            <li *ngFor="let image of mediaItem.source_images_gcs">
              {{ image }}
            </li>
          </ul>
        </div>

        <!-- Image Specific -->
        <div *ngIf="mediaItem.modifiers?.length">
          <strong class="font-semibold">Modifiers:</strong>
          <ul>
            <li *ngFor="let modifier of mediaItem.modifiers">{{ modifier }}</li>
          </ul>
        </div>

        <div *ngIf="mediaItem.num_media">
          <strong class="font-semibold">Number of Images:</strong>
          <p>{{ mediaItem.num_media }}</p>
        </div>

        <div *ngIf="mediaItem.aspect_ratio">
          <strong class="font-semibold">Aspect Ratio:</strong>
          <p>{{ mediaItem.aspect_ratio }}</p>
        </div>

        <div *ngIf="mediaItem.style">
          <strong class="font-semibold">Image Style:</strong>
          <p>{{ mediaItem.style }}</p>
        </div>

        <div *ngIf="mediaItem.lighting">
          <strong class="font-semibold">Lighting:</strong>
          <p>{{ mediaItem.lighting }}</p>
        </div>

        <div *ngIf="mediaItem.color_and_tone">
          <strong class="font-semibold">Color and Tone:</strong>
          <p>{{ mediaItem.color_and_tone }}</p>
        </div>

        <div *ngIf="mediaItem.composition">
          <strong class="font-semibold">Composition:</strong>
          <p>{{ mediaItem.composition }}</p>
        </div>

        <div *ngIf="mediaItem.seed">
          <strong class="font-semibold">Seed:</strong>
          <p>{{ mediaItem.seed }}</p>
        </div>

        <div *ngIf="mediaItem.critique">
          <strong class="font-semibold">Critique:</strong>
          <p>{{ mediaItem.critique }}</p>
        </div>

        <!-- Video Specific -->
        <div *ngIf="mediaItem.aspect">
          <strong class="font-semibold">Aspect Ratio:</strong>
          <p>{{ mediaItem.aspect }}</p>
        </div>

        <div *ngIf="mediaItem.duration">
          <strong class="font-semibold">Duration:</strong>
          <p>{{ mediaItem.duration }} seconds</p>
        </div>

        <div *ngIf="mediaItem.reference_image">
          <strong class="font-semibold">Reference Image:</strong>
          <p>{{ mediaItem.reference_image }}</p>
        </div>

        <div *ngIf="mediaItem.last_reference_image">
          <strong class="font-semibold">Last Reference Image:</strong>
          <p>{{ mediaItem.last_reference_image }}</p>
        </div>

        <!-- <div *ngIf="mediaItem.enhanced_prompt_used !== undefined">
                                          <strong class="font-semibold">Enhanced Prompt Used:</strong>
                                          <p>{{ mediaItem.enhanced_prompt_used }}</p>
        </div> -->

        <div *ngIf="mediaItem.negative_prompt">
          <strong class="font-semibold">Negative Prompt:</strong>
          <p>{{ mediaItem.negative_prompt }}</p>
        </div>

        <div>
          <strong class="font-semibold">Add Watermark:</strong>
          <p>{{ mediaItem.add_watermark ?? 'N/A' }}</p>
        </div>

        <div *ngIf="mediaItem.comment">
          <strong class="font-semibold">Comment:</strong>
          <p>{{ mediaItem.comment }}</p>
        </div>
        <!-- Music Specific -->
        <div *ngIf="mediaItem.audio_analysis">
          <b class="font-semibold">Audio Analysis:</b>
          <pre
            class="bg-gray-800 p-2 rounded-md text-sm whitespace-pre-wrap break-words"
            >{{ mediaItem.audio_analysis | json }}</pre>
        </div>

        <!-- Debugging -->
        <div *ngIf="mediaItem.raw_data">
          <b class="font-semibold">Raw Data:</b>
          <pre
            class="bg-gray-800 p-2 rounded-md text-sm whitespace-pre-wrap break-words"
            >{{ mediaItem.raw_data | json }}</pre>
        </div>
      </div>
    </div>
  </div>
</div>
